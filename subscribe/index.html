<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subscribe Openly</title>
    <link rel="stylesheet" href="../styles.css">
    <link rel="icon" href="../icon.svg" type="image/png">
    <meta name="description" content="Subscribe to websites openly with your preferred feed reader.">
</head>
<body>
    <main>
        <hgroup style="margin-top: 0;">
            <img src="../icon.svg" alt="Subscribe Openly Icon" width="64" height="64">
            <h1><a href="/">Subscribe Openly</a></h1>
        </hgroup>
        <form method="GET" action="/subscribe/">
            <input type="url" placeholder="https://example.com" name="url" id="url" />
            <button type="submit">Subscribe</button>
        </form>
        <section>
            <div id="preamble">
                <p><span id="domain"></span> has a web feed âœ¨</p>
                <p>This means you can subscribe to them in a web reader.</p>
                <p>New to web feeds? <a href="https://aboutfeeds.com">Learn more</a>.</p>
                <hr>
            </div>
            <p>Choose your reader below to subscribe to this feed:</p>
        </section>
        <ul id="readers">
            <li id="artemis">
                <a href="https://artemis.jamesg.blog/add?url=" data-action="subscribe">
                    <img src="../icons/artemis.svg" alt="Artemis Icon" />
                    Artemis
                </a>
            </li>
            <li id="feedbin">
                <a href="https://www.newsblur.com/?url=" data-action="subscribe">
                    <img src="../icons/feedbin.svg" alt="Feedbin Icon" />
                    Feedbin
                </a>
            </li>
            <li id="newsblur">
                <a href="https://www.newsblur.com/?url=" data-action="subscribe">
                    <img src="../icons/newsblur.png" alt="Newsblur Icon" />
                    Newsblur
                </a>
            </li>
            <li id="inoreader">
                <a href="https://www.inoreader.com/search/feeds/?url=" data-action="subscribe">
                    <img src="../icons/inoreader.jpg" alt="Inoreader Icon" />
                    Inoreader
                </a>
            </li>
            <li id="netnewswire">
                <a href="netnewswire://" data-action="subscribe">
                    <img src="../icons/netnewswire.png" alt="NetNewsWire Icon" />
                    NetNewsWire
                </a>
            </li>
            <li id="feedly">
                <a href="https://feedly.com/i/discover/sources/search/feed/" data-action="subscribe">
                    <img src="../icons/feedly.png" alt="Feedly Icon" />
                    Feedly
                </a>
            </li>
            <li id="tapestry">
                <a href="tapestry://feedfinder?url=" data-action="subscribe">
                    <img src="../icons/tapestry.webp" alt="Tapestry Icon" />
                    Tapestry
                </a>
            </li>
        </ul>
        <footer>
            <p><a href="/about/">Use Subscribe Openly on your own website.</a></p>
            <p>Maintained by <a href="https://jamesg.blog">capjamesg</a>. <a href="https://github.com/capjamesg/subscribe-openly">View source</a>.</p>
        </footer>
    </main>
    <script>
        var urlParams = new URLSearchParams(window.location.search);
        // if "url" does not exist, redirect to home
        if (!urlParams.has('url')) {
            window.location.href = '/';
        }

        // if doesn't start with https://, add
        if (!urlParams.get('url').startsWith('https://') && !urlParams.get('url').startsWith('http://')) {
            urlParams.set('url', 'https://' + urlParams.get('url'));
        }

        var dataUrls = document.querySelectorAll('a[data-action="subscribe"]');
        for (var dataUrl in dataUrls) {
            var url = dataUrls[dataUrl].href;
            // get url param
            var urlParam = urlParams.get('url');
            dataUrls[dataUrl].href += encodeURIComponent(urlParam);
            document.querySelector('input[type="url"]').value = urlParam || '';
        }
        if (urlParams.get('ref') == 'home') {
            document.querySelector('#preamble').style.display = 'none';
        }
        if (urlParams.get('url')) {
            document.querySelector('#domain').textContent = new URL(urlParams.get('url')).hostname;
        }

        if (urlParams.get('prefer')) {
            var preferred = document.getElementById(urlParams.get('prefer'));
            var readers = document.getElementById('readers');
            if (preferred) {
                readers.prepend(preferred);
                preferred.classList.add('preferred');
            }
        }
    </script>
    <script>
        /* add http:// to URL fields on blur or when enter is pressed */
        /* https://aaronparecki.com/2018/06/03/4/url-form-field */
        document.addEventListener('DOMContentLoaded', function() {
            function addDefaultScheme(target) {
            if(target.value.match(/^(?!https?:).+\..+/)) {
                target.value = "http://"+target.value;
            }
            }
            var elements = document.querySelectorAll("input[type=url]");
            Array.prototype.forEach.call(elements, function(el, i){
            el.addEventListener("blur", function(e){
                addDefaultScheme(e.target);
            });
            el.addEventListener("keydown", function(e){
                if(e.keyCode == 13) {
                addDefaultScheme(e.target);
                }
            });
            });
        });
    </script>
</body>
</html>
